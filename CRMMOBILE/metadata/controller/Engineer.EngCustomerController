{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "Engineer.EngCustomerController"
    },
    "name": "MyController",
    "designerId": "740de32a-4c6f-4425-812e-7d52f4569d30",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "container#Customer",
                "designer|targetType": "Ext.Container",
                "fn": "onCustomerInitialize",
                "implHandler": [
                    "var me = this;",
                    "",
                    "customerCurPage = 0;",
                    "pagesize = 20;",
                    "",
                    "updatejurisdiction = false;",
                    "deletejueisdiction = false;",
                    "",
                    "var searchkey = Ext.getCmp('Customer_searchkey').getValue();",
                    "",
                    "Ext.getCmp('Customer_ListHotline').getStore().removeAll();",
                    "",
                    "// 初始化下拉刷新、滑动按钮插件",
                    "var faultList = Ext.getCmp('Customer_ListHotline');",
                    "faultList.setPlugins(",
                    "    [",
                    "        {",
                    "            autoSnapBack: false,",
                    "            lastUpdatedText: '上次刷新:&nbsp;',",
                    "            loadedText: '已刷新',",
                    "            loadingText: '正在刷新客户维护...',",
                    "            pullText: '下拉刷新...',",
                    "            releaseText: '放开开始刷新...',",
                    "            type: 'pullrefresh',",
                    "            listeners : {",
                    "                latestfetched : function() {",
                    "//                     faultCurPage=1;",
                    "                    me.doCustomer_LoadList(",
                    "                        1,",
                    "                        pagesize,",
                    "                        searchkey,",
                    "                        'refresh'",
                    "                    );",
                    "                }",
                    "            }",
                    "        },",
                    "        // 以下滑动按钮插件应从EngHomeController的onEngHomeInitial()中复制！",
                    "        {",
                    "            xclass: 'ux.SlideActions',",
                    "            openPosition: 150,",
                    "            buttons:",
                    "            [",
                    "                // 按钮1",
                    "                {",
                    "                    xtype: 'button',",
                    "                    baseCls: 'x-button liftnet-list-button liftnet-bgColor-blue',",
                    "                    text: '修改',",
                    "                    initial: function(btn) {",
                    "                        //初始化滑动按钮",
                    "                       btn.hidden = updatejurisdiction;",
                    "                    },",
                    "                    listeners: {",
                    "                        tap: function(button, e){",
                    "                            e.stopPropagation();",
                    "                            return false;",
                    "                        },",
                    "                        scope: this",
                    "                    },",
                    "                    handler: function(button, e) {",
                    "                        faultList.fireEvent('hide'); // 隐藏列表的滑动按钮组",
                    "                        liftnet.app.getController('Engineer.EngCustomerController').",
                    "                        doCustomer_Process({",
                    "                            record: button.getRecord(),",
                    "                            operation: '修改'",
                    "                        });",
                    "                    },",
                    "                    width:200",
                    "                },",
                    "                // 按钮2",
                    "                {",
                    "                    xtype: 'button',",
                    "                    baseCls: 'x-button liftnet-list-button liftnet-bgColor-red',",
                    "                    text: '删除',",
                    "                    initial: function(btn) {",
                    "                        //初始化滑动按钮",
                    "                       btn.hidden = deletejueisdiction;",
                    "                    },",
                    "                    listeners: {",
                    "                        tap: function(button, e){",
                    "                            e.stopPropagation();",
                    "                            return false;",
                    "                        },",
                    "                        scope: this",
                    "                    },",
                    "                    handler: function(button, e) {",
                    "                        faultList.fireEvent('hide'); // 隐藏列表的滑动按钮组",
                    "                        liftnet.app.getController('Engineer.EngCustomerController').",
                    "                        doCustomer_Process({",
                    "                            record: button.getRecord(),",
                    "                            operation: '删除'",
                    "                        });",
                    "                    }",
                    "                }",
                    "            ]",
                    "        }",
                    "    ]",
                    ");",
                    "",
                    "",
                    "//监听滑动结束事件",
                    "var faultScroller = faultList.getScrollable().getScroller();",
                    "faultScroller.on('scrollend',function(scroll, x, y, eOpts){",
                    "    if(customerCurPage===0){",
                    "        return;",
                    "     }",
                    "    //滑动到底部加载更多",
                    "    if(y+faultScroller.getContainerSize().y==faultScroller.getSize().y){",
                    "        console.log('loadmore');",
                    "        loadMask.show();",
                    "        var scrollparm = {",
                    "            scroller:faultScroller,",
                    "            x:x,",
                    "            y:y+80//Item的高度+Tpl样式中各种边距",
                    "        };",
                    "        var keyword = Ext.getCmp('Customer_searchkey').getValue();",
                    "        if(!keyword){",
                    "            keyword='';",
                    "        }",
                    "        me.doCustomer_LoadList(",
                    "            ++customerCurPage,",
                    "            pagesize,",
                    "            keyword,",
                    "            'loadmore',",
                    "            scrollparm);",
                    "    }",
                    "});",
                    "",
                    "me.doCustomer_LoadList(",
                    "                        1,",
                    "                        pagesize,",
                    "                        searchkey,",
                    "                        'refresh'",
                    "                    );",
                    ""
                ],
                "name": "initialize"
            },
            "name": "onCustomerInitialize",
            "designerId": "79f364f4-96c8-4297-8336-c21a637f092f"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "page",
                    "pagesize",
                    "searchkey",
                    "action",
                    "scrollparm"
                ],
                "fn": "doCustomer_LoadList",
                "implHandler": [
                    "//客户维护标签页 - 客户维护列表刷新",
                    "",
                    "if(Ext.getCmp('Customer_ListHotline')){",
                    "",
                    "    var flowstatus = '';",
                    "var flowstatusT = Ext.getCmp('Customer_Btn').getText();",
                    "switch(flowstatusT){",
                    "    case '全部':",
                    "        flowstatus='%';",
                    "        break;",
                    "    case '重点客户':",
                    "        flowstatus='A';",
                    "        break;",
                    "    case '普通客户':",
                    "        flowstatus='B';",
                    "        break;",
                    "    case '非优先客户':",
                    "        flowstatus='C';",
                    "        break;",
                    "",
                    "}",
                    "",
                    "if(searchkey==='')",
                    "    searchkey = Ext.getCmp('Customer_searchkey').getValue();",
                    "",
                    "var parm = {",
                    "    userid: global.getUserId(),",
                    "    curpagenum:page,",
                    "    pagesize:pagesize,",
                    "    searchkey:searchkey,",
                    "    flowstatus:flowstatus",
                    "};",
                    "",
                    "console.log('----传到后台的参数----');",
                    "console.log(parm);",
                    "console.log('----传到后台的参数----');",
                    "",
                    "Ext.getCmp('Customer_ListHotline').getStore().loadDat(",
                    "    function(n,jurisdiction) {",
                    "        if(scrollparm){",
                    "             scrollparm.scroller.scrollTo(scrollparm.x,scrollparm.y);",
                    "             loadMask.hide();",
                    "        }",
                    "        if(n==='resetCurPage'){",
                    "            customerCurPage = 1;",
                    "        }",
                    "",
                    "        //新建权限",
                    "        var addjurisdiction = jurisdiction.addjurisdiction=='N';",
                    "        Ext.getCmp('Customer_Add').setHidden(addjurisdiction);",
                    "        ",
                    "        updatejurisdiction = jurisdiction.updatejurisdiction=='N';",
                    "        deletejueisdiction = jurisdiction.deletejueisdiction=='N';",
                    "",
                    "        console.log('客户列表搜索完成!');",
                    "    },",
                    "    function(info) {",
                    "        Ext.toast(info);",
                    "        if(info==='加载更多客户数据失败'){",
                    "            customerCurPage--;",
                    "        }",
                    "        if(info==='没有更多数据！'){",
                    "            customerCurPage = 0;//没有更多数据的时候重置页数为0，不触发上拉事件",
                    "        }",
                    "//         if(faultCurPage!=1){",
                    "//              faultCurPage--;//获取数据失败页数减一",
                    "//         }",
                    "        loadMask.hide();",
                    "    },",
                    "    parm,",
                    "    action",
                    ");",
                    "}"
                ]
            },
            "name": "doCustomer_LoadList",
            "designerId": "12650339-462d-45f1-8452-ccc4334d4b9b"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#Customer_ReturnButton",
                "designer|targetType": "Ext.Button",
                "fn": "onCustomer_ReturnButtonTap",
                "implHandler": [
                    "//返回上页",
                    "viewUtil.goLast();"
                ],
                "name": "tap"
            },
            "name": "onCustomer_ReturnButtonTap",
            "designerId": "f6cfd7a2-f608-4a56-8c69-472a278a215a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#Customer_ReturnButton2",
                "designer|targetType": "Ext.Button",
                "fn": "onCustomer_ReturnButton2ButtonTap",
                "implHandler": [
                    "//返回上页",
                    "//先删除联系人STORE",
                    "Ext.getCmp('Customer_linker_list').getStore().removeAll();",
                    "",
                    "viewUtil.goLast();"
                ],
                "name": "tap"
            },
            "name": "onCustomer_ReturnButton2ButtonTap",
            "designerId": "6334a92e-e520-41e4-9759-9a88399c265e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "list#Customer_ListHotline",
                "designer|targetType": "Ext.dataview.List",
                "fn": "onCustomer_ListHotlineTap",
                "implHandler": [
                    "viewUtil.goNext('Engineer.EngCustomerDisPlay', {record: record});"
                ],
                "name": "itemtap"
            },
            "name": "onCustomer_ListHotlineTap",
            "designerId": "66364010-e4a2-4c62-9e55-4f9f4064a343"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "panel#EngCustomerDisplay",
                "designer|targetType": "Ext.Panel",
                "fn": "onEngCustomerDisplayInitialize",
                "implHandler": [
                    "//初始化客户查看信息",
                    "loadMask.show();",
                    "",
                    "var me = this;",
                    "var userid = global.getUserId();",
                    "var now = Ext.Date.format(new Date(), 'Y-m-d H:i');",
                    "var position = map.getLocation().addr;",
                    "if(!position || position==='') position = '(未知位置)';",
                    "",
                    "var taskrecord = component.initialConfig.parm.record;",
                    "var custid = taskrecord.get('custid'); // 客户编号",
                    "",
                    "// 初始化下拉选择项目",
                    "//dataUtil.createStore('common_sxsourcelist').loadDat(Ext.emptyFn,Ext.emptyFn);",
                    "//dataUtil.createStore('common_getdeptlist').loadDat(Ext.emptyFn,Ext.emptyFn);",
                    "",
                    "// 取出客户明细数据",
                    "var store = dataUtil.createStore('cu_cudetail');",
                    "store.loadDat(",
                    "    function() {",
                    "        // 显示受信单数据",
                    "        var record = store.getData().get(0);",
                    "        console.log('----后台获取信息start----');",
                    "        console.log(record);",
                    "        console.log('----后台获取信息end----');",
                    "",
                    "",
                    "        Ext.getCmp('EngCustomerForm').setRecord(record);",
                    "        ",
                    "        if(record.get('r8')=='Y'){",
                    "            Ext.getCmp('EngCustomerForm').setValues({'r8':'已装'});",
                    "        }else{",
                    "            Ext.getCmp('EngCustomerForm').setValues({'r8':'未装'});",
                    "        }",
                    "",
                    "",
                    "",
                    "        var linkerbean = record.get('linkerbean');",
                    "        console.log(linkerbean);",
                    "        var linkerStr = '';",
                    "        if(linkerbean.length>0){",
                    "            for(var i=0;i<linkerbean.length;i++){",
                    "                if(i!==0){",
                    "                   linkerStr +=',';",
                    "                }",
                    "                linkerStr += linkerbean[i].contractman;",
                    "            }",
                    "        }",
                    "        var flowuserlist = record.get('flowuserlist');",
                    "        console.log(flowuserlist);",
                    "        var flowuserStr = '';",
                    "        if(flowuserlist.length>0){",
                    "            for(var j=0;j<flowuserlist.length;j++){",
                    "                if(j!==0){",
                    "                    flowuserStr+=',';",
                    "                }",
                    "                flowuserStr += flowuserlist[j].flowuser+'('+flowuserlist[j].storagename+')';",
                    "            }",
                    "        }",
                    "",
                    "        Ext.getCmp('Customer_Levele').setHtml(record.get('levelename'));",
                    "",
                    "        Ext.getCmp('EngCustomerForm').setValues({",
                    "                linkerStr:\tlinkerStr,",
                    "                flowuserStr: flowuserStr,",
                    "                custname: record.get('cstname'),",
                    "                createname: record.get('createname')+'('+record.get('createdept')+')'",
                    "",
                    "            });",
                    "",
                    "        loadMask.hide();",
                    "    },",
                    "    function() {",
                    "        loadMask.hide();",
                    "        Ext.toast('读取客户资料失败！');",
                    "        viewUtil.goLast();",
                    "    },",
                    "    custid",
                    ");",
                    ""
                ],
                "name": "initialize"
            },
            "name": "onEngCustomerDisplayInitialize",
            "designerId": "86a01632-cbb5-49d1-ad5c-c70e39122b96"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#Customer_Btn",
                "designer|targetType": "Ext.Button",
                "fn": "onCustomer_BtnTap",
                "implHandler": [
                    " //客户维护-客户级别筛选按钮",
                    "popMenu.show('Engineer.EngCustomerStatus', button);"
                ],
                "name": "tap"
            },
            "name": "onCustomer_BtnTap",
            "designerId": "a2f14429-9e27-4a27-80a5-9e7914f89bce"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#CustomerStatus_0",
                "designer|targetType": "Ext.Button",
                "fn": "onCustomerStatus_0Tap",
                "implHandler": [
                    "// 全部",
                    "this.doEngCustomerFilter(button.getText());"
                ],
                "name": "tap"
            },
            "name": "onCustomerStatus_0Tap",
            "designerId": "485bf09e-b4bf-4f88-96da-31b1135d51b1"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#CustomerStatus_1",
                "designer|targetType": "Ext.Button",
                "fn": "onCustomerStatus_1Tap",
                "implHandler": [
                    "// 重点客户",
                    "this.doEngCustomerFilter(button.getText());"
                ],
                "name": "tap"
            },
            "name": "onCustomerStatus_1Tap",
            "designerId": "f71ecf0f-fcae-4770-8e2c-1a5ed7f114e8"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#CustomerStatus_2",
                "designer|targetType": "Ext.Button",
                "fn": "onCustomerStatus_2Tap",
                "implHandler": [
                    "// 普通客户",
                    "this.doEngCustomerFilter(button.getText());"
                ],
                "name": "tap"
            },
            "name": "onCustomerStatus_2Tap",
            "designerId": "fb8b8dcb-9221-4a4b-800d-6d743ec0d86d"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#CustomerStatus_3",
                "designer|targetType": "Ext.Button",
                "fn": "onCustomerStatus_3Tap",
                "implHandler": [
                    "// 非优先客户",
                    "this.doEngCustomerFilter(button.getText());"
                ],
                "name": "tap"
            },
            "name": "onCustomerStatus_3Tap",
            "designerId": "d52b2e29-e9d3-4d25-bd1d-1369166742ee"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "filter"
                ],
                "fn": "doEngCustomerFilter",
                "implHandler": [
                    "popMenu.getShowBy().setText(filter);",
                    "popMenu.hide();",
                    "var searchkey = Ext.getCmp('Customer_searchkey').getValue();",
                    "this.doCustomer_LoadList(1,20,searchkey,'refresh');"
                ]
            },
            "name": "doEngCustomerFilter",
            "designerId": "188db2db-4553-452e-9afa-da17537d4138"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "searchfield#Customer_searchkey",
                "designer|targetType": "Ext.field.Search",
                "fn": "onCustomer_searchkeyChange",
                "implHandler": [
                    "var Custome_Search = textfield.getValue();",
                    "if(!Custome_Search||Custome_Search===''){",
                    "    Custome_Search = '';",
                    "//     return;",
                    "}",
                    "//联网搜索",
                    "// faultCurPage = 1;",
                    "this.doCustomer_LoadList(1,20,Custome_Search,'refresh');",
                    "// Ext.getCmp('EngFault_ListHotline').getStore().filteDat(Enfault_Search);"
                ],
                "name": "change"
            },
            "name": "onCustomer_searchkeyChange",
            "designerId": "c52cf633-0244-4abb-9ae2-9f3e17ebfc3a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#Customer_Add",
                "designer|targetType": "Ext.Button",
                "fn": "onCustomer_AddTap",
                "implHandler": [
                    "// Ext.toast('客户新建功能正在开发中'+'<br><br>'+'敬请期待！');",
                    "viewUtil.goNext('Engineer.EngCustomerAdd');"
                ],
                "name": "tap"
            },
            "name": "onCustomer_AddTap",
            "designerId": "30622e33-db8d-43ed-baec-ac8fcd4b2d54"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "panel#EngCustomerAdd",
                "designer|targetType": "Ext.Panel",
                "fn": "onEngCustomerAddInitialize",
                "implHandler": [
                    "var me = this;",
                    "",
                    "// 初始化下拉选择项目",
                    "dataUtil.createStore('common_getdeptlist').loadDat(Ext.emptyFn,Ext.emptyFn);",
                    "dataUtil.createStore('cu_levelist').loadDat(Ext.emptyFn,Ext.emptyFn,{userid:global.getUserId()});",
                    "dataUtil.createStore('cu_typelist').loadDat(Ext.emptyFn,Ext.emptyFn,{userid:global.getUserId()});",
                    "",
                    "Ext.getCmp('Customer_linker_list').getStore().removeAll();",
                    "",
                    "//初始化联系人列表滑动效果",
                    "var linkerList = Ext.getCmp('Customer_linker_list');",
                    "linkerList.setPlugins(",
                    "    [",
                    "        {",
                    "            xclass: 'ux.SlideActions',",
                    "            openPosition: 75,",
                    "            buttons:",
                    "            [",
                    "                // 删除按钮",
                    "                {",
                    "                    xtype: 'button',",
                    "                    baseCls: 'x-button liftnet-list-button liftnet-bgColor-red',",
                    "                    text: '<i class=\"fa fa-lg fa-trash-o\"></i>',",
                    "                    listeners: {",
                    "                        tap: function(button, e){",
                    "                            e.stopPropagation();",
                    "                            return false;",
                    "                        },",
                    "                        scope: this",
                    "                    },",
                    "                    handler: function(button, e) {",
                    "                        linkerList.fireEvent('hide'); // 隐藏列表的滑动按钮组",
                    "                        linkerList.getStore().remove(button.getRecord());",
                    "                    }",
                    "                }",
                    "            ]",
                    "        }",
                    "    ]",
                    ");",
                    "",
                    "",
                    "",
                    "if(component.initialConfig.parm){",
                    "    if(component.initialConfig.parm.record) {//修改",
                    "        Ext.getCmp('Customer_Title').setTitle('修改客户维护');",
                    "        var custid = component.initialConfig.parm.record.get('custid');",
                    "        console.log(custid);",
                    "",
                    "        // 取出客户明细数据",
                    "        loadMask.show();",
                    "        var store = dataUtil.createStore('cu_cudetail');",
                    "        store.loadDat(",
                    "            function() {",
                    "                // 显示受信单数据",
                    "                var record = store.getData().get(0);",
                    "                console.log('----后台获取信息start----');",
                    "                console.log(record);",
                    "                console.log('----后台获取信息end----');",
                    "",
                    "                Ext.getCmp('Customer_Info_form').setRecord(record);",
                    "",
                    "                var linkerbean = record.get('linkerbean');",
                    "                console.log(linkerbean);",
                    "                Ext.getCmp('Customer_linker_list').getStore().add(linkerbean);",
                    "",
                    "                //处理跟进人数据",
                    "                var flowuserStr = '';",
                    "                var flowuserID = '';",
                    "                var flowuserlist =record.get('flowuserlist');",
                    "                if(flowuserlist!=null && flowuserlist.length>0){",
                    "                    for(var i=0;i<flowuserlist.length;i++){",
                    "                        var flowuserid = flowuserlist[i].flowuserid; //跟进人ID",
                    "                        var storageid = flowuserlist[i].storageid;\t//部门ID",
                    "                        var flowuser = flowuserlist[i].flowuser;\t//跟进人姓名",
                    "                        var storagename = flowuserlist[i].storagename;\t//部门名",
                    "",
                    "                        if(i!==0){",
                    "                            flowuserStr +=',';",
                    "                            flowuserID +=',';",
                    "                        }",
                    "",
                    "                        flowuserStr += flowuser+'('+storagename+')';",
                    "                        flowuserID += flowuserid+'#'+storageid;",
                    "",
                    "                    }",
                    "                }",
                    "",
                    "                Ext.getCmp('Customer_add_flowuserStr').setValue(flowuserStr);",
                    "                Ext.getCmp('Customer_add_flowuserID').setValue(flowuserID);",
                    "",
                    "",
                    "",
                    "                Ext.getCmp('Customer_Info_form').setValues({",
                    "                        custname: record.get('cstname'),",
                    "                        oldCustname: record.get('cstname')",
                    "                    });",
                    "",
                    "                loadMask.hide();",
                    "            },",
                    "            function() {",
                    "                loadMask.hide();",
                    "                Ext.toast('读取客户资料失败！');",
                    "                viewUtil.goLast();",
                    "            },",
                    "            custid",
                    "        );",
                    "",
                    "    }",
                    "}",
                    ""
                ],
                "name": "initialize"
            },
            "name": "onEngCustomerAddInitialize",
            "designerId": "05b94067-0c34-4059-8366-7f054daf4799"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#Customer_linker_add",
                "designer|targetType": "Ext.Button",
                "fn": "onCustomer_linker_addTap",
                "implHandler": [
                    "//添加联系人按钮",
                    "",
                    "",
                    "viewUtil.goNext('Engineer.EngCustomerLinker',{});"
                ],
                "name": "tap"
            },
            "name": "onCustomer_linker_addTap",
            "designerId": "58501fbc-d77c-4954-a349-37ca33341470"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "parm"
                ],
                "fn": "doCustomer_Process",
                "implHandler": [
                    "//客户修改/删除 入口",
                    "var me = this;",
                    "var operation = parm.operation;",
                    "var record = parm.record;",
                    "",
                    "switch(operation) {",
                    "    case '修改':",
                    "",
                    "        viewUtil.goNext('Engineer.EngCustomerAdd',{record:record});",
                    "",
                    "        break;",
                    "    case '删除':",
                    "            Ext.Msg.confirm(\"注意\", \"确认是否删除？\", function(n) {",
                    "            if(n=='no')return;",
                    "",
                    "            var userid = global.getUserId();",
                    "",
                    "            var adapter_parm = {",
                    "                userid : userid,",
                    "                custid  : record.get('custid')",
                    "            };",
                    "            var store = dataUtil.createStore('cu_cuscens');",
                    "            loadMask.show();",
                    "            store.deleteDat(",
                    "                function(info) {",
                    "                    loadMask.hide();",
                    "",
                    "                    Ext.toast(info);",
                    "",
                    "                    // 刷新电梯档案列表",
                    "                    me.doCustomer_LoadList(1,20,'','refresh');",
                    "",
                    "                },",
                    "                function(info) {",
                    "                    loadMask.hide();",
                    "                    if(!info) info = '(未知)';",
                    "                    Ext.toast('未能完成' + operation + '操作，错误信息是：' + info);",
                    "                },",
                    "                adapter_parm",
                    "            );",
                    "",
                    "        });",
                    "        return;",
                    "",
                    "    default:",
                    "        Ext.toast('未知的操作:' + operation);",
                    "        return;",
                    "}",
                    "",
                    "",
                    ""
                ]
            },
            "name": "doCustomer_Process",
            "designerId": "4e4cc11d-895c-4f7a-86b4-7221092a149a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "textareafield#Customer_add_flowuserStr",
                "designer|params": [
                    "textareafield"
                ],
                "designer|targetType": "Ext.field.TextArea",
                "fn": "onCustomer_flowuserStrTap",
                "implHandler": [
                    "//跟进人",
                    "var tpl =",
                    "    '<div class=\"liftnet-font-size12 liftnet-fontColor-gray\">{class1}</div>' +",
                    "    '<div class=\"liftnet-font-size14 liftnet-fontColor-darkGray\">{username}({storagename})</div>' ;",
                    "",
                    "viewUtil.goNext('Common.ComMultiSelect', {",
                    "    textfield: textareafield,",
                    "    storeid: 'cu_flowuserlist',",
                    "    storeparm: {",
                    "        userid: global.getUserId(),",
                    "        searchname: '',",
                    "        curpagenum: 1,",
                    "        pagesize: 20",
                    "    },",
                    "    itemtpl: tpl,",
                    "    paging: true,",
                    "    allowedit: false,",
                    "    allowsearch: true,",
                    "    fnSetFilter: function(parm, text) {",
                    "        parm.searchname = text;",
                    "        return parm;",
                    "    },",
                    "    fnSelected: function(record) {",
                    "        console.log(record);",
                    "        if(typeof(record)==='string') {",
                    "            console.log('---------');",
                    "        } else {",
                    "            var flowuserStr = '';",
                    "            var flowuserID = '';",
                    "            for(var i = 0; i < record.length; i++){",
                    "                if(i!==0){",
                    "                    flowuserStr +=',';",
                    "                    flowuserID +=',';",
                    "                }",
                    "                flowuserStr += record[i].get('username')+'('+record[i].get('storagename')+')';",
                    "                flowuserID += record[i].get('userid')+'#'+record[i].get('storageid');",
                    "",
                    "            }",
                    "            Ext.getCmp('Customer_Info_form').setValues({",
                    "                flowuserStr: flowuserStr,",
                    "",
                    "            });",
                    "            ",
                    "            Ext.getCmp('Customer_add_flowuserID').setValue(flowuserID);",
                    "        }",
                    "    }",
                    "});",
                    "textareafield.blur();",
                    ""
                ],
                "name": "tap"
            },
            "name": "onCustomer_flowuserStrTap",
            "designerId": "4ddc1876-9fb6-4be4-9633-74daf8ad7cf0"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "textfield#Customer_add_r7",
                "designer|params": [
                    "textfield"
                ],
                "designer|targetType": "Ext.field.Text",
                "fn": "onCustomer_add_r7Tap",
                "implHandler": [
                    "//上级单位",
                    "var tpl =",
                    "'<div class=\"liftnet-font-size14 liftnet-fontColor-darkGray\">{custname}</div>';",
                    "",
                    "viewUtil.goNext('Common.ComSelect', {",
                    "    textfield: textfield,",
                    "    storeid: 'cu_culist',",
                    "    storeparm: {",
                    "        userid: global.getUserId(),",
                    "        searchkey: '',",
                    "        flowstatus:'%',",
                    "        curpagenum: 1,",
                    "        pagesize: 20",
                    "    },",
                    "    itemtpl: tpl,",
                    "    paging: true,",
                    "    allowedit: false,",
                    "    allowsearch: true,",
                    "    fnSetFilter: function(parm, text) {",
                    "        parm.searchkey = text;",
                    "        return parm;",
                    "    },",
                    "    fnSelected: function(record) {",
                    "        if(typeof(record)==='string') {",
                    "            textfield.setValue(record);",
                    "        } else {",
                    "            var value = record.get('custname');",
                    "            textfield.setValue(value);",
                    "            Ext.getCmp('Customer_add_r6').setValue(record.get('custid'));",
                    "        }",
                    "    }",
                    "});",
                    "textfield.blur();"
                ],
                "name": "tap"
            },
            "name": "onCustomer_add_r7Tap",
            "designerId": "c86ffe3f-0093-4551-ae86-900df99a71c1"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "selectfield#Customer_add_r8",
                "designer|targetType": "Ext.field.Select",
                "fn": "onCustomer_r8Change",
                "implHandler": [
                    "if(newValue==oldValue) return;",
                    "",
                    "if(newValue==='Y'){",
                    "    Ext.getCmp('Customer_add_licensenumber').setRequired(true);",
                    "    Ext.getCmp('Customer_add_r9').setRequired(true);",
                    "    Ext.getCmp('Customer_add_r9').setReadOnly(false);",
                    "",
                    "}else{",
                    "    Ext.getCmp('Customer_add_licensenumber').setRequired(false);",
                    "    Ext.getCmp('Customer_add_r9').setRequired(false);",
                    "    Ext.getCmp('Customer_add_r9').setReadOnly(true);",
                    "    ",
                    "    //清空数据",
                    "    Ext.getCmp('Customer_add_licensenumber').setValue('');",
                    "    Ext.getCmp('Customer_add_r9').setValue('');",
                    "",
                    "}"
                ],
                "name": "change"
            },
            "name": "onCustomer_r8Change",
            "designerId": "c5817eb7-e7f2-454f-aa6e-217498f97e58"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "textfield#Customer_add_phone",
                "designer|targetType": "Ext.field.Text",
                "fn": "onCustomer_phoneChange",
                "implHandler": [
                    "//公司联络电话",
                    "if(!newValue) return;",
                    "",
                    "if(!global.isTelNo(newValue)) {",
                    "    textfield.suspendEvents();",
                    "    Ext.toast('电话号码格式不正确！');",
                    "    textfield.resumeEvents(false);",
                    "    return;",
                    "}"
                ],
                "name": "change"
            },
            "name": "onCustomer_phoneChange",
            "designerId": "2bb5ddfe-95f5-4311-9e95-da0e6fc24f04"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "textfield#Customer_add_postno",
                "designer|targetType": "Ext.field.Text",
                "fn": "onCustomer_postnoChange",
                "implHandler": [
                    "//邮政编码",
                    "if(!newValue) return;",
                    "",
                    "if(!newValue.match(/^[0-9]{6}$/)){",
                    "    textfield.suspendEvents();",
                    "    Ext.toast('邮政编码格式不正确！');",
                    "    textfield.resumeEvents(false);",
                    "}"
                ],
                "name": "change"
            },
            "name": "onCustomer_postnoChange",
            "designerId": "19420ff8-2c59-47f9-b7db-2934a2159503"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "textfield#Customer_add_fax",
                "designer|targetType": "Ext.field.Text",
                "fn": "onCustomer_faxChange",
                "implHandler": [
                    "//传真",
                    "if(!newValue) return;",
                    "",
                    "if(!newValue.match(/^[+]{0,1}(\\d){1,3}[ ]?([-]?((\\d)|[ ]){1,12})+$/)){",
                    "    textfield.suspendEvents();",
                    "    Ext.toast('传真格式不正确！');",
                    "    textfield.resumeEvents(false);",
                    "}"
                ],
                "name": "change"
            },
            "name": "onCustomer_faxChange",
            "designerId": "6ce004cb-d2af-4cc6-8cb1-4d684d874f18"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "textfield#Customer_add_custname",
                "designer|targetType": "Ext.field.Text",
                "fn": "onCustomer_add_custnameBlur",
                "implHandler": [
                    "//后台检测该客户是否存在",
                    "var custname = textfield.getValue();",
                    "var oldCustname = Ext.getCmp('Customer_add_oldCustname').getValue();",
                    "",
                    "if(!custname || custname==oldCustname) return;",
                    "",
                    "",
                    "var parm = {",
                    "    userid : global.getUserId(),",
                    "    custname : custname",
                    "};",
                    "",
                    "var store = dataUtil.createStore('cu_checkcustname');",
                    "loadMask.show();",
                    "",
                    "store.updateDat(",
                    "    function(status) {",
                    "        loadMask.hide();",
                    "        if(status=='1') {",
                    "",
                    "        }else{",
                    "            Ext.Msg.alert('注意', '该客户名称已存在',Ext.emptyFn);",
                    "            textfield.setValue('');",
                    "            textfield.focus();",
                    "        }",
                    "    },",
                    "    function(info) {",
                    "        loadMask.hide();",
                    "        if(!info) info = '(未知)';",
                    "        Ext.toast('检测客户名称唯一性操作有误，错误信息是：' + info);",
                    "    },",
                    "    parm",
                    ");",
                    "",
                    "",
                    "",
                    ""
                ],
                "name": "blur"
            },
            "name": "onCustomer_add_custnameBlur",
            "designerId": "76f8f1a0-08f3-439e-8104-835cda3f2550"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#Customer_SaveBtn",
                "designer|targetType": "Ext.Button",
                "fn": "onCustomer_SaveBtnTap",
                "implHandler": [
                    "//客户新建/修改保存",
                    "",
                    "this.doCustomer_Save(button.getText());",
                    ""
                ],
                "name": "tap"
            },
            "name": "onCustomer_SaveBtnTap",
            "designerId": "34ac06e7-79f1-4b6a-9bed-5dc3bd55aa67"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "action"
                ],
                "fn": "doCustomer_Save",
                "implHandler": [
                    "var me  = this;",
                    "var form = Ext.getCmp('Customer_Info_form');",
                    "var client = form.getValues();",
                    "",
                    "",
                    "// 检查必填项目",
                    "var fields = form.getFields();",
                    "for(var name in fields) {",
                    "  field = fields[name];",
                    "  if(field.getRequired() && field.getValue()==='') {",
                    "      Ext.Msg.alert('注意', '必须填写\"' + field.getLabel() + '\"', Ext.emptyFn);",
                    "      return;",
                    "  }",
                    "}",
                    "",
                    "//验证邮政编码",
                    "var postno = Ext.getCmp('Customer_add_postno').getValue();",
                    "if(postno!=''){",
                    "    if(!postno.match(/^[0-9]{6}$/)){",
                    "        Ext.toast('邮政编码格式不正确！');",
                    "        return;",
                    "    }",
                    "}",
                    "",
                    "//验证公司联络电话",
                    "var phone = Ext.getCmp('Customer_add_phone').getValue();",
                    "if(phone!=''){",
                    "    if(!global.isTelNo(phone)) {",
                    "        Ext.toast('电话号码格式不正确！');",
                    "        return;",
                    "    }",
                    "}",
                    "",
                    "//验证传真",
                    "var fax = Ext.getCmp('Customer_add_fax').getValue();",
                    "if(fax!=''){",
                    "    if(!fax.match(/^[+]{0,1}(\\d){1,3}[ ]?([-]?((\\d)|[ ]){1,12})+$/)){",
                    "        Ext.toast('传真格式不正确！');",
                    "        return;",
                    "    }",
                    "}",
                    "",
                    "",
                    "client.mugaddress = '';//保养电梯地址",
                    "client.creatorid = global.getUserId();//创建人ID",
                    "",
                    "",
                    "//处理跟进人",
                    "var flowuserJSON = [];",
                    "var flowuserIDS = Ext.getCmp('Customer_add_flowuserID').getValue();",
                    "if(flowuserIDS){",
                    "    var floruserid = flowuserIDS.split(',');",
                    "    if(floruserid.length>0){",
                    "        for(var i=0;i<floruserid.length;i++){",
                    "            var flowuserid = floruserid[i].split('#')[0];",
                    "            var storageid = floruserid[i].split('#')[1];",
                    "            flowuserJSON[i] = {",
                    "                flowuserid  : flowuserid,",
                    "                storageid\t: storageid,",
                    "                remark\t\t: ''",
                    "            };",
                    "        }",
                    "    }",
                    "}",
                    "console.log(flowuserJSON);",
                    "client.flowuserlist = flowuserJSON;",
                    "",
                    "",
                    "//处理联系人",
                    "var linkerList = [];",
                    "var linkerStore = Ext.getCmp('Customer_linker_list').getStore();",
                    "linkerStore.getData().each(function(r) {",
                    "    linkerList.push({",
                    "        contractman: r.get('contractman'),",
                    "        mbphone: r.get('mbphone'),",
                    "        ob1: r.get('ob1'),",
                    "        othercontact:\tr.get('othercontact'),",
                    "        remail:\tr.get('remail')",
                    "    });",
                    "});",
                    "client.linkerbean = linkerList;",
                    "",
                    "var parm = {",
                    "    userid: global.getUserId(),",
                    "    client: client",
                    "};",
                    "console.log(parm);",
                    "var store = dataUtil.createStore('cu_cuscens');",
                    "loadMask.show();",
                    "",
                    "store.updateDat(",
                    "    function() {",
                    "        loadMask.hide();",
                    "        Ext.toast(action + '操作完成！');",
                    "",
                    "        //刷新列表",
                    "        me.doCustomer_LoadList(1,20,'','refresh');",
                    "        viewUtil.goLast();",
                    "    },",
                    "    function(info) {",
                    "        loadMask.hide();",
                    "        if(!info) info = '(未知)';",
                    "        Ext.toast('未能完成' + action + '操作，错误信息是：' + info);",
                    "    },",
                    "    parm",
                    ");",
                    "",
                    "",
                    "",
                    ""
                ]
            },
            "name": "doCustomer_Save",
            "designerId": "cee533fb-cf79-4c71-bf96-5e1d15c947f7"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "button#linker_SaveBtn",
                "designer|targetType": "Ext.Button",
                "fn": "onlinker_SaveBtnTap",
                "implHandler": [
                    "//客户联系人保存",
                    "var data = Ext.getCmp('Customer_linker_form').getValues();",
                    "if(!data.contractman ||  data.contractman==='' ) {",
                    "    Ext.toast('请输入联系人！');",
                    "    return;",
                    "}",
                    "if(!data.mbphone ||  data.mbphone==='' ) {",
                    "    Ext.toast('请输入电话！');",
                    "    return;",
                    "}",
                    "",
                    "var linker_index = Ext.getCmp('linker_index').getValue();",
                    "console.log(linker_index);",
                    "",
                    "if(linker_index!=''){",
                    "    Ext.getCmp('Customer_linker_list').getStore().getAt(linker_index).set(data);",
                    "}else{",
                    "    Ext.getCmp('Customer_linker_list').getStore().add(data);",
                    "}",
                    "viewUtil.goLast();"
                ],
                "name": "tap"
            },
            "name": "onlinker_SaveBtnTap",
            "designerId": "d5de3ed6-4a6f-4591-bee1-819b5f0fc1fe"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "textfield#linker_mbphone",
                "designer|targetType": "Ext.field.Text",
                "fn": "onlinker_mbphoneChange",
                "implHandler": [
                    "//联系人电话",
                    "if(!newValue) return;",
                    "",
                    "if(!global.isTelNo(newValue)) {",
                    "    textfield.suspendEvents();",
                    "    textfield.setValue(oldValue);",
                    "    Ext.toast('电话号码格式不正确！');",
                    "    textfield.resumeEvents(false);",
                    "}"
                ],
                "name": "change"
            },
            "name": "onlinker_mbphoneChange",
            "designerId": "0714f686-6e59-4f6c-8159-0c19208bc3e7"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "list#Customer_linker_list",
                "designer|targetType": "Ext.dataview.List",
                "fn": "onCustomer_linker_listTap",
                "implHandler": [
                    "viewUtil.goNext('Engineer.EngCustomerLinker',{record:record,index:index});"
                ],
                "name": "itemtap"
            },
            "name": "onCustomer_linker_listTap",
            "designerId": "0c73cd7b-32fe-4499-90df-788348c1d756"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "panel#EngCustomerLinker",
                "designer|targetType": "Ext.Panel",
                "fn": "onEngCustomerLinkerInitialize",
                "implHandler": [
                    "var taskrecord = component.initialConfig.parm.record;",
                    "var index = component.initialConfig.parm.index;",
                    "console.log(index+'____');",
                    "",
                    "if(taskrecord){",
                    "    Ext.getCmp('Customer_linker_form').setRecord(taskrecord);",
                    "}",
                    "if(index!==undefined){",
                    "    Ext.getCmp('linker_index').setValue(index);",
                    "}"
                ],
                "name": "initialize"
            },
            "name": "onEngCustomerLinkerInitialize",
            "designerId": "eacc5d71-c9ec-4456-b981-e3eeba247e74"
        }
    ]
}