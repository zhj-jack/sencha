/*
 * File: app/store/eng_todoall.js
 *
 * This file was generated by Sencha Architect version 3.5.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('liftnet.store.eng_todoall', {
    extend: 'Ext.data.Store',

    requires: [
        'Ext.data.Field'
    ],

    config: {
        storeId: 'eng_todoall',
        fields: [
            {
                name: 'id'
            },
            {
                name: 'type'
            },
            {
                name: 'r1'
            },
            {
                name: 'r2'
            },
            {
                name: 'r3'
            },
            {
                name: 'r4'
            },
            {
                name: 'r5'
            },
            {
                name: 'r6'
            },
            {
                name: 'nextstate'
            },
            {
                name: 'color'
            },
            {
                name: 'titleIcon'
            },
            {
                name: 'titleColor'
            },
            {
                name: 'urgent'
            },
            {
                name: 'statusColor'
            },
            {
                name: 'todoTpl'
            }
        ]
    },

    /*
        id:(受信单号，故障报告单号，保养流水号，首检单号)必须唯一
        type:(A故障受信/B故障报告/C保养实绩/D首检任务/E保养任务)
        r1:左上(故障编号，故障编号，保养计划日期)
        r2:左中(项目名称，项目名称，项目名称)
        r3:左下(项目地址，维修人员，注册码)
        r4:右上(状态，状态，保养类型)
        r5:右下(受理时间，完工时间，梯号)
        r6:type=A: 1表示困人,0表示没困人/type=C:2表示已完工,1表示保养中,0表示没开始
    */
    loadDat: function(onSuccess, onFailure, parm) {
        var me = this;
        //console.log(JsonUtil.convertToString(parm));
        if(global.isWorklight()) {
            // adapter取数
            var url = '/adapters/common/api/1.0/dbrwlist';
            var adapterparm = {
                userid:global.getUserId()
            };
            callPostAdapter(
                url, adapterparm,
                function(ret) {
                    if(ret.status.code!=200){
                        onFailure('读取待办任务列表失败');
                    }else{
                        var d = me.decoDat(ret.data);
                        me.setData(d);
                        onSuccess(d.length);
                    }
                },
                function() {
                    onFailure('读取待办任务列表失败');
                }
                );

        } else {
            this.clearFilter();
            // 全部待办-演示数据
            var d = this.decoDat([
                {
                    type:'C',//保养计划
                    id:'BY2015000001', //保养流水号
                    r1:'2016-01-01(三)',//保养计划日期
                    r2:'广州凯旋大酒店有限公司',
                    r3:'3110-440100-20030',//注册码
                    r4:'保养', //保养类型
                    r5:'A1',//梯号
                    r6:1,
                    stateUrl:'resources/images/maintenance_icon02.png',
                    nextstate: [
                                {name:"到场",url:"http://127.0.0.1/到场"}
                            ],
                },
                {
                    type:'C',//保养计划
                    id:'BY2015000002', //保养流水号
                    r1:'2015-12-01(四)',//保养计划日期
                    r2:'广州市荔湾区黄沙大道144号大冶有色大厦',
                    r3:'3110-440100-20030',//注册码
                    r4:'保养', //保养类型
                    r5:'A2',//梯号
                    r6:2,
                    stateUrl:'resources/images/maintenance_icon03.png',
                    nextstate: [
                                {name:"完工",url:"http://127.0.0.1/完工"}
                            ],

                },

                {
                    type:'A',//故障受信
                    id:'BX2015060404', //受信单号
                    r1:'BX2015060404',//故障编号
                    r2:'广州市粤商投资有限公司',//项目名称
                    r3:'广州市白云区人和龙苑小区',//项目地址
                    r4:'待分配', //状态
                    r5:'2016-04-01',//受理时间
                    r6:1,
                    nextstate: [
                                {name:"派工",url:"http://127.0.0.1/派工"},
                                {name:"关闭",url:"http://127.0.0.1/关闭"}
                            ],
                },
                {
                    type:'C',//保养计划
                    id:'BY2015000003', //保养流水号
                    r1:'2015-10-01',//保养计划日期
                    r2:'广州凯旋大酒店有限公司',
                    r3:'3110-440100-20030',//注册码
                    r4:'保养', //保养类型
                    r5:'A1',//梯号
                    r6:0,
                    stateUrl:'resources/images/maintenance_icon02.png',
                    nextstate: [
                                {name:"到场",url:"http://127.0.0.1/到场"}
                            ],
                },
                {
                    type:'A',//故障受信
                    id:'BX2015060405', //受信单号
                    r1:'BX2015060405',//故障编号
                    r2:'广州市粤商投资有限公司',//项目名称
                    r3:'广州市白云区人和龙苑小区',//项目地址
                    r4:'已关闭', //状态
                    r5:'2015-11-01',//受理时间
                    r6:0,
                    nextstate: [],
                },

                {
                    type:'A',
                    id:'BX2015060407',
                    r1:'BX2015060406',
                    r2:'广州市粤商投资有限公司',
                    r3:'广州市白云区人和龙苑小区',
                    r4:'已退回',
                    r5:'2016-05-01',
                    r6:1,
                    nextstate: [
                                {name:"派工",url:"http://127.0.0.1/派工"},
                                {name:"关闭",url:"http://127.0.0.1/关闭"}
                            ],
                },
                {
                    type:'B',//故障报告
                    id:'20151201001', //报告编号
                    r1:'1234-5678-9000',//故障编号
                    r2:'广州市华越友联科技发展有限公司',//项目名称
                    r3:'李小明',//维修人员
                    r4:'待提交', //状态
                    r5:'2016-01-30',//完工时间
                    r6:'',
                    nextstate:[{name:"提交",url:"http://127.0.0.1/提交"}],
                },
                {
                    type:'A',
                    id:'BX2015060406',
                    r1:'BX2015060406',
                    r2:'广州市粤商投资有限公司',
                    r3:'广州市白云区人和龙苑小区',
                    r4:'已退回',
                    r5:'2015-06-01',
                    r6:0,
                    nextstate: [
                                {name:"派工",url:"http://127.0.0.1/派工"},
                                {name:"关闭",url:"http://127.0.0.1/关闭"}
                            ],
                },
                {
                    type:'B',//故障报告
                    id:'20151201003', //报告编号
                    r1:'1234-5678-9000',//故障编号
                    r2:'广州市华越友联科技发展有限公司',//项目名称
                    r3:'作业人员',//维修人员
                    r4:'已完成', //状态
                    r5:'2015-09-11',//完工时间
                    r6:'',
                    nextstate: [],
                },
                {
                    type:'D',//故障报告
                    id:'测试id1', //报告编号
                    r1:'测试首检任务',//故障编号
                    r2:'测试R2',//项目名称
                    r3:'广州市华越友联科技发展有限公司',//维修人员
                    r4:'测试R4', //状态
                    r5:'测试R5',//完工时间
                    r6:'',
                    nextstate: [],
                },
                {
                    type:'E',//故障报告
                    id:'测试id2', //报告编号
                    r1:'测试保养任务',//故障编号
                    r2:'测试R2',//项目名称
                    r3:'广州市华越友联科技发展有限公司',//维修人员
                    r4:'测试R4', //状态
                    r5:'测试R5',//完工时间
                    r6:'',
                    nextstate: [],
                },
            ]
            );
            this.setData(d);
            onSuccess(d.length);
        }
    },

    decoDat: function(data) {
        if(!data) return([]);

        for(var i = 0; i < data.length; i++){

            switch(data[i].r4) {
                        case '待提交':
                        case '待分配':
                            data[i].color = 'liftnet-fontColor-green';
                            break;

                        case '已完成':
                        case '待接收':
                            data[i].color = 'liftnet-fontColor-orange';
                            break;

                        case '已审核':
                            data[i].color = 'liftnet-fontColor-darkGray';
                            break;

                        case '已退回':
                            data[i].color = 'liftnet-fontColor-red';
                            break;

                    }
            switch(data[i].type){
                case 'A':
                    switch(data[i].r6){
                        case 0:
                        case '0':
                            data[i].urgent = '';
                            data[i].titleIcon = '<i class="ln ln-repair"></i> ';
                            break;
                        case 1:
                        case '1':
                            data[i].urgent = '<div style="margin-left:6px" class="liftnet-remindBg liftnet-remindBg-red"></div><div style="margin-left:6px" class="liftnet-remind liftnet-font-size12">急</div>';
                            data[i].titleIcon = '<i class="ln ln-stranded"></i> ';
                            break;
                    }
                    data[i].todoTpl = '<div style="margin:-10px -8px" class="liftnet-home-listConBox">'+
                        data[i].urgent+'<div class="liftnet-home-listConBox-left"><div class="liftnet-font-size16 '+
                        data[i].color+'">'+
                        data[i].titleIcon+data[i].r1+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray">'+
                        data[i].r2+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray">'+
                        data[i].r3+'</div></div><div class="liftnet-home-listConBox-right"><div class="liftnet-home-listConBox-state liftnet-font-right liftnet-font-size12 '+
                        data[i].color+'">'+
                        data[i].r4+'<i class="fa fa-circle-o"></i></div><div class="liftnet-font-size12 liftnet-fontColor-gray liftnet-font-right"><i class="fa fa-clock-o"></i> '+
                        data[i].r5+'</div></div></div>';
                    break;
                case 'B':
                    data[i].urgent = '';
                    data[i].titleIcon = '<i class="ln ln-message2"></i> ';
                    data[i].todoTpl = '<div style="margin:-10px -8px" class="liftnet-home-listConBox">'+
                        data[i].urgent+'<div class="liftnet-home-listConBox-left"><div class="liftnet-font-size16 '+
                        data[i].color+'">'+
                        data[i].titleIcon+data[i].r1+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray">'+

                        data[i].r2+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray">'+
                        data[i].r3+'</div></div><div class="liftnet-home-listConBox-right"><div class="liftnet-home-listConBox-state liftnet-font-right liftnet-font-size12 '+
                        data[i].color+'">'+
                        data[i].r4+'<i class="fa fa-circle-o"></i></div><div class="liftnet-font-size12 liftnet-fontColor-gray liftnet-font-right"><i class="fa fa-clock-o"></i> '+
                        data[i].r5+'</div></div></div>';
                    break;
                case 'C': //保养计划

                    switch(data[i].r6){
                        case 0:
                        case '0':
                            data[i].color = 'liftnet-fontColor-red';
                            data[i].stateUrl='resources/images/maintenance_icon01.png';
                            break;
                        case 1:
                        case '1':
                            data[i].color = 'liftnet-fontColor-blue';
                            data[i].stateUrl='resources/images/maintenance_icon02.png';
                            break;
                        case 2:
                        case '2':
                            data[i].stateUrl='resources/images/maintenance_icon03.png';
                            data[i].color = 'liftnet-fontColor-orange';
                            break;
                    }
                    data[i].todoTpl = '<div style="margin:-4px 0px -8px -10px" class="liftnet-Maintenance-handleList"><div class="liftnet-Maintenance-handleList-left"><img src="'+
                        data[i].stateUrl+'" /></div><div class="liftnet-Maintenance-handleList-right"><div><div class="liftnet-font-size12 liftnet-fontColor-gray" style="float:right">'+
                        data[i].r4+'</div><div class="liftnet-font-size16 '+
                        data[i].color+'" style="float:left">'+
                        data[i].r1+'</div></div><div class="liftnet-font-size12 liftnet-fontColor-gray">'+
                        data[i].r2+'</div><div><div class="liftnet-font-size12 liftnet-fontColor-gray" style="float:right">'+
                        data[i].r5+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray" style="float:left">'+
                        data[i].r3+'</div></div></div></div>';
                    break;

                case 'D':
                    data[i].color = 'liftnet-fontColor-orange';

                    data[i].urgent = '';
                    data[i].titleIcon = '<i class="ln ln-message2"></i> ';
                    data[i].todoTpl = '<div style="margin:-10px -8px" class="liftnet-home-listConBox">'+
                        data[i].urgent+'<div class="liftnet-home-listConBox-left"><div class="liftnet-font-size16 '+
                        data[i].color+'">'+
                        data[i].r1+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray">'+

                        data[i].r4+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray">'+
                        data[i].r3+'</div></div><div class="liftnet-home-listConBox-right"><div class="liftnet-home-listConBox-state liftnet-font-right liftnet-font-size12 '+
                        data[i].color+'">'+
                        data[i].r2+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray liftnet-font-right"> '+
                        data[i].r5+'</div></div></div>';

                    break;

                case 'E':

                    data[i].color = 'liftnet-fontColor-blue';

                    data[i].urgent = '';
                    data[i].titleIcon = '<i class="ln ln-message2"></i> ';
                    data[i].todoTpl = '<div style="margin:-10px -8px" class="liftnet-home-listConBox">'+
                        data[i].urgent+'<div style="width:100%" class="liftnet-home-listConBox-left"><div class="liftnet-font-size16 '+
                        data[i].color+'">'+
                        data[i].r1+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray">'+

                        data[i].r2+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray">'+
                        data[i].r3+'</div></div><div class="liftnet-home-listConBox-right"><div class="liftnet-font-right liftnet-font-size12 '+
                        data[i].color+'">'+
                        data[i].r4+'</div><div class="liftnet-font-size12 liftnet-fontColor-gray liftnet-font-right"> '+
                        data[i].r5+'</div></div></div>';


                    break;
            }

        }

        return data;
    },

    filteDatByType: function(type, keyword) {
        this.clearFilter();
        if(type!=='') {//分类显示
            this.filterBy(function(item) {
                var s = item.get("r1")+item.get("r2")+item.get("r3");
                if(type=='All'){//全部
                    if(keyword!==''){//有关键字搜索
                        return (s.toUpperCase().indexOf(keyword.toUpperCase())>=0);
                    }else{//无关键字返回全部
                        return true;
                    }
                }else{//分类
                    if(keyword!==''){//有关键字搜索该类相关数据
                        return item.get('type')==type&&
                            (s.toUpperCase().indexOf(keyword.toUpperCase())>=0);
                    }else{//无关键字显示该类全部数据
                        return item.get('type')==type;
                    }
                }
            });
        }
    },

    filteDatByDate: function(parm,type) {
        this.clearFilter();

        if(parm!=='') {//根据日期筛选
            this.filterBy(function(item) {
                    var s ;
                    if(item.get('type')=='C'){
                        s = item.get("r1").substring(0,10);
                    }else{
                        s = item.get('r5').substring(0,10);
                    }
                    var date = Date.parse(s);
                    if(parm.type=='All'){//全部.
                        return (date >= parm.start && date <= parm.end);
                    }
                    //加类别判断
                    return item.get('type')==parm.type&&(date >= parm.start && date <= parm.end);
                }
            );
        }
    },

    searchDat: function(parm,type) {
        var me = this;
        this.clearFilter();

        if(parm!=='') {//搜索框有内容
            this.filterBy(function(item) {
                var s = item.get("r1")+item.get("r2")+item.get("r3");
                if(type=='All'){
                   return (s.toUpperCase().indexOf(parm.toUpperCase())>=0);
                }
                return item.get('type')==type&&
                    (s.toUpperCase().indexOf(parm.toUpperCase())>=0);
            });
        }else{//搜索框清除输入内容
            this.filterBy(function(item) {
                //根据右侧分类按钮显示相应类型的数据
                if(type=='All'){
                    return true;
                }else{
                    return item.get('type')==type;
                }
            });

        }
    }

});