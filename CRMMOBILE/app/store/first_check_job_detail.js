/*
 * File: app/store/first_check_job_detail.js
 *
 * This file was generated by Sencha Architect version 3.5.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('liftnet.store.first_check_job_detail', {
    extend: 'Ext.data.Store',

    requires: [
        'Ext.data.Field'
    ],

    config: {
        storeId: 'first_check_job_detail',
        fields: [
            {
                name: 'jnl'
            },
            {
                name: 'status'
            },
            {
                name: 'projectname'
            },
            {
                name: 'projectid'
            },
            {
                name: 'contractid'
            },
            {
                name: 'projectaddress'
            },
            {
                name: 'liftnum'
            },
            {
                name: 'checkednum'
            },
            {
                name: 'remark'
            },
            {
                name: 'dispatchtype'
            },
            {
                name: 'planstartdate'
            },
            {
                name: 'planenddate'
            },
            {
                name: 'createid'
            },
            {
                name: 'creatorname'
            },
            {
                name: 'createdept'
            },
            {
                name: 'createdeptid'
            },
            {
                name: 'checkuser'
            },
            {
                name: 'elevator'
            },
            {
                name: 'nextstate'
            },
            {
                name: 'detailrowid'
            }
        ]
    },

    updateDat: function(onSuccess, onFailure, parm) {
        var me = this;
        // console.log('调用派工单处理接口：');
        console.log(parm);
        if(global.isWorklight()) {
            //派工处理，审批处理
            var url = '/adapters/firstcheck/api/1.0/fcdopration';
            var userid = global.getUserId();
            var adapterParm = {userid:userid,jnl:parm.jnl};

            callPostAdapter(
                url, adapterParm,
                function(ret) {
                    if(ret.status.code===200) {
                        console.log(ret.jnl);
                        onSuccess(ret.jnl);
                    } else {
                        console.log(ret.status.info);
                        onFailure(ret.status.info);
                    }
                },
                function() {
                    onFailure('(未知)');
                }
            );
        } else {
            onSuccess('TRNO-TEST12345');
        }
    },

    loadDat: function(onSuccess, onFailure, parm) {
        //旧派工单查看
        var me = this;

        if(global.isWorklight()) {
            //派工查看
        //     var url = '/adapters/firstcheck/api/1.0/fcddetail';
            //审批查看
        //     var url = '/adapters/firstcheck/api/1.0/fcdaduitdetail';
            var url = parm.url;
            var userid = global.getUserId();
            var adapterParm = {userid:userid,jnl:parm.jnl};

            callPostAdapter(
                url, adapterParm,
                function(ret) {
                    if(ret.status.code!=200){
                        onFailure('读取派工单详细信息失败');
                    }else{
                        me.setData(me.decoDat(ret.data));
                        onSuccess();
                    }
                },
                function() {
                    onFailure('读取派工单详细信息失败');
                }
                );
        } else {
            this.setData(me.decoDat([
                {
                    jnl:'SJ160415001',
                    status:'待审',
                    projectname:'projectname',
                    projectid:'projectid',
                    contractid:'contractid',
                    projectaddress:'projectaddress',
                    liftnum:'30',
                    checkednum:'10',
                    remark:parm.url,
                    dispatchtype:0,
                    createid:'Demo',
                    creatorname:'张三',
                    createdeptid:'1',
                    createdept:'质检部',
                    planstartdate:'2015-10-10',
                    planenddate:'2015-10-20',
                    elevator:[
                        {
                            prono:'电梯注册码1',
                            liftautono:'序号1',
                            detailrowid:'detailrowid1'

                        },
                        {
                            prono:'电梯注册码2',
                            liftautono:'序号2',
                            detailrowid:'detailrowid2'

                        }
                    ],
                    checkuser:[
                        {userid:'1',
                         username:'检验员1',
                         departmentid:'1',
                         departmentname:'质检部',
                         usertype:'1'},
                        {userid:'2',
                         username:'检验员2',
                         departmentid:'2',
                         departmentname:'维保部',
                         usertype:'2'},
                        {userid:'3',
                         username:'检验员3',
                         departmentid:'3',
                         departmentname:'质检部',
                         usertype:'3'},
                    ],
                    nextstate:[
        //                 {name:'同意',state:'1'},
        //                 {name:'不同意',state:'2'},
        //
        //                 {name:'删除',state:'4'},
                        {name:'接收',state:'5'},
                        {name:'退回',state:'3'},
        //                 {name:'提交',state:'6'},
        //                 {name:'作废',state:'7'},
                    ]
                },
            ]));
                onSuccess();
                }
    },

    decoDat: function(data) {
        if(!data){
            return ([]);
        }
        var me = this;
        var checkusers = data[0].checkuser;
        var usertypename = {"0":"负责人","1":"检验人员","2":"实习生","3":"其他人员"};
        for(var i = 0,length=checkusers.length; i<length;i++){
            checkusers[i].usertypename = usertypename[checkusers[i].usertype];
        }
        data[0].checkuser = checkusers;
        return data;
    }

});