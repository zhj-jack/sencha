/*
 * File: app/store/by_maintainplanlist.js
 *
 * This file was generated by Sencha Architect version 3.5.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('liftnet.store.by_maintainplanlist', {
    extend: 'Ext.data.Store',

    requires: [
        'Ext.data.Field'
    ],

    config: {
        storeId: 'by_maintainplanlist',
        fields: [
            {
                name: 'pid'
            },
            {
                name: 'projectname'
            },
            {
                name: 'prodno'
            },
            {
                name: 'liftno'
            },
            {
                name: 'man'
            },
            {
                name: 'plandate'
            },
            {
                name: 'ordernum'
            },
            {
                name: 'flowstatus'
            },
            {
                name: 'nextstate'
            },
            {
                name: 'stateColor'
            },
            {
                name: 'titleColor'
            },
            {
                name: 'plantype'
            }
        ]
    },

    loadDat: function(onSuccess, onFailure, parm) {
                var me = this;
                //this.setData([]);
                console.log(JsonUtil.convertToString(parm));
                if(global.isWorklight()) {// adapter取数
                    var url = '/adapters/byrw/api/1.0/bysjlist';
                    callPostAdapter(
                        url, parm,
                        function(ret) {
                            var d = me.decoDat(ret.data);
                            //me.setData(d);

                        var n = d.length;
                        if(n===0){
                            if(parm.curpagenum==1){//第一页
                               Ext.toast('暂时没有数据!');
                               me.setData(d);
                            }else{
                             Ext.toast('没有更多数据了!');
                            loadMask.hide();
                            }
                        }else{
                              //第一次加载直接设置数据
                            if(parm.curpagenum==1){
                                me.setData(d);

                               // onSuccess(d.length);
                            }else{
                                //分页用法，在原有数据上继续添加

                               me.addData(d);
                             //  onSuccess(d.length);
                            }
                        }

                            onSuccess(d.length);
                        },
                        onFailure);
                } else {
                    console.log('list');
                    // 演示数据
                    var d = this.decoDat([
                        {
                            pid:		'1',
                            projectname:		'第一点五项目',
                            prodno:	'3110-025684-548965-1100',
                            liftno:	'A1',
                            man:	'张三,李四',
                            plandate:'2016-10-01',
                            ordernum:	'1',
                            nextstate:	[{name:'到场',state:''}],
                            stateColor:	'',
                            stateUrl:	'',
                            titleIcon:	'',
                            titleColor:	'',
                            plantype:'半月',
                            flowstatus:'未开始'
                        },
                        {
                            pid:		'2',
                            projectname:		'大型项目',
                            prodno:	'3110-02684-54865-1111',
                            liftno:	'A2',
                            man:	'王五,刘六',
                            plandate:'2016-09-15',
                            ordernum:	'1',
                            nextstate:	[{name:'完工',state:''}],
                            stateColor:	'',
                            stateUrl:	'',
                            titleIcon:	'',
                            titleColor:	'',
                            plantype:'季度',
                            flowstatus:'到场'
                        },
                        {
                            pid:		'1',
                            projectname:		'小型项目',
                            prodno:	'3110-45684-48965-2222',
                            liftno:	'A1',
                            man:	'田七,王八',
                            plandate:'2016-11-12',
                            ordernum:	'2',
                            nextstate:	'',
                            stateColor:	'',
                            stateUrl:	'',
                            titleIcon:	'',
                            titleColor:	'',
                            plantype:'年度',
                            flowstatus:'完工'
                        }
                    ]);
                    this.setData(d);
                    onSuccess(d.length);
                    console.log(this.getData());
                }
    },

    decoDat: function(data) {
        // stateUrl:	状态的图片地址
        // stateColor:	状态的颜色
        // titleIcon:	标题的图标
        // titleColor:	标题的颜色

        if(!data) return([]);

        for(var i=0;i<data.length; i++) {
            switch(data[i].flowstatus) {
                case '未开始':
                    data[i].stateColor = 'liftnet-fontColor-gray';
                    //             data[i].stateUrl   = 'resources/images/maintenance_icon01.png';
                    //             data[i].titleIcon  = '<i class="ln ln-message1"></i>';
                    data[i].titleColor = 'liftnet-fontColor-gray';
                    break;

                case '到场':
                    data[i].stateColor = 'liftnet-fontColor-orange';
                    //             data[i].stateUrl   = 'resources/images/maintenance_icon02.png';
                    //             data[i].titleIcon  = '<i class="ln ln-message1"></i>';
                    data[i].titleColor = 'liftnet-fontColor-orange';
                    break;

                case '完工':
                    data[i].stateColor = 'liftnet-fontColor-blue';
                    //             data[i].stateUrl   = 'resources/images/maintenance_icon03.png';
                    //             data[i].titleIcon  = '<i class="ln ln-message1"></i>';
                    data[i].titleColor = 'liftnet-fontColor-blue';
                    break;
            }
        }

        return(data);
    },

    filteDat: function(parm) {
        this.clearFilter();
         console.log(parm);
        if(parm!=='') {
            this.filterBy(function(item) {
                var s = item.get("projectname") + ' ' + item.get("prodno") + ' ' + item.get("man")+' ' + item.get("plantype");
                return (s.toUpperCase().indexOf(parm.toUpperCase())>=0);
            });
        }
    }

});