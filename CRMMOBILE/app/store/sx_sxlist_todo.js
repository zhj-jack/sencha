/*
 * File: app/store/sx_sxlist_todo.js
 *
 * This file was generated by Sencha Architect version 3.5.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('liftnet.store.sx_sxlist_todo', {
    extend: 'Ext.data.Store',

    requires: [
        'Ext.data.Field'
    ],

    config: {
        storeId: 'sx_sxlist_todo',
        fields: [
            {
                name: 'operdate',
                type: 'string'
            },
            {
                name: 'istrap',
                type: 'string'
            },
            {
                name: 'trno',
                type: 'string'
            },
            {
                name: 'unitname',
                type: 'string'
            },
            {
                name: 'addr',
                type: 'string'
            },
            {
                name: 'url',
                type: 'string'
            },
            {
                name: 'taskid',
                type: 'string'
            },
            {
                name: 'state',
                type: 'string'
            },
            {
                name: 'nextstate',
                type: 'auto'
            },
            {
                name: 'titleIcon',
                type: 'string'
            },
            {
                name: 'titleColor',
                type: 'string'
            },
            {
                name: 'urgent',
                type: 'string'
            },
            {
                name: 'statusColor',
                type: 'string'
            }
        ]
    },

    loadDat: function(onSuccess, onFailure, parm) {
        var me = this;
        this.setData([]);

        if(global.isWorklight()) {
            var url = '/adapters/sx/api/1.0/sxlist';
            callPostAdapter(
                url, parm,
                function(ret) {
                    var d = me.decoDat(ret.data);
                    me.setData(d);
                    onSuccess(d.length);
                },
                onFailure);
        } else {
            var d = this.decoDat([
                {
                    operdate: '2015-12-01 21:25',
                    istrap: '1',
                    state: '待分配',
                    trno: 'BX2015060404',
                    unitname: '广州市粤商投资有限公司',
                    addr: '广州市白云区人和龙苑小区',
                    nextstate: [
                        {name:"派工",url:"http://127.0.0.1/派工"},
                        {name:"关闭",url:"http://127.0.0.1/关闭"}
                    ],
                    taskid: 'TASK123456',
                    url: '查询明细url',
                    urgent: '',
                    statusColor: '',
                    titleIcon: '',
                    titleColor: '',
                },
                {
                    operdate: '2015-12-01 11:55',
                    istrap: '0',
                    state: '已关闭',
                    trno: 'BX2015060405',
                    unitname: '广州市粤商投资有限公司',
                    addr: '广州市白云区人和龙苑小区',
                    nextstate: [],
                    taskid: 'TASK123456',
                    url: '查询明细url',
                    urgent: '',
                    statusColor: '',
                    titleIcon: '',
                    titleColor: '',
                },
                {
                    operdate: '2015-12-01 11:55',
                    istrap: '1',
                    state: '已退回',
                    trno: 'BX2015060406',
                    unitname: '广州市粤商投资有限公司',
                    addr: '广州市白云区人和龙苑小区',
                    nextstate: [
                        {name:"派工",url:"http://127.0.0.1/派工"},
                        {name:"关闭",url:"http://127.0.0.1/关闭"}
                    ],
                    taskid: 'TASK123456',
                    url: '查询明细url',
                    urgent: '',
                    statusColor: '',
                    titleIcon: '',
                    titleColor: '',
                },
                {
                    operdate: '2015-12-01 21:25',
                    istrap: '1',
                    state: '待接收',
                    trno: 'BX2015060404',
                    unitname: '广州市粤商投资有限公司',
                    addr: '广州市白云区人和龙苑小区',
                    nextstate: [
                        {name:"接收",url:"http://127.0.0.1/接收"},
                        {name:"退单",url:"http://127.0.0.1/退单"}
                    ],
                    taskid: 'TASK123456',
                    url: '查询明细url',
                    urgent: '',
                    statusColor: '',
                    titleIcon: '',
                    titleColor: '',
                },
                {
                    operdate: '2015-12-01 11:55',
                    istrap: '0',
                    state: '未出发',
                    trno: 'BX2015060405',
                    unitname: '广州市粤商投资有限公司',
                    addr: '广州市白云区人和龙苑小区',
                    nextstate: [
                        {name:"出发",url:"http://127.0.0.1/出发"}
                    ],
                    taskid: 'TASK123456',
                    url: '查询明细url',
                    urgent: '',
                    statusColor: '',
                    titleIcon: '',
                    titleColor: '',
                },
                {
                    operdate: '2015-12-01 11:55',
                    istrap: '1',
                    state: '路途中',
                    trno: 'BX2015060406',
                    unitname: '广州市粤商投资有限公司',
                    addr: '广州市白云区人和龙苑小区',
                    nextstate: [
                        {name:"到场",url:"http://127.0.0.1/到场"}
                    ],
                    taskid: 'TASK123456',
                    url: '查询明细url',
                    urgent: '',
                    statusColor: '',
                    titleIcon: '',
                    titleColor: '',
                },
                {
                    operdate: '2015-12-01 11:55',
                    istrap: '1',
                    state: '维修中',
                    trno: 'BX2015060406',
                    unitname: '广州市粤商投资有限公司',
                    addr: '广州市白云区人和龙苑小区',
                    nextstate: [
                        /*{name:"拍照",url:"http://127.0.0.1/拍照"},
                        {name:"扫描",url:"http://127.0.0.1/扫描"},*/
                        {name:"完工",url:"http://127.0.0.1/完工"}
                    ],
                    taskid: 'TASK123456',
                    url: '查询明细url',
                    urgent: '',
                    statusColor: '',
                    titleIcon: '',
                    titleColor: '',
                },
                {
                    operdate: '2015-12-01 11:55',
                    istrap: '1',
                    state: '救援中',
                    trno: 'BX2015060406',
                    unitname: '广州市粤商投资有限公司',
                    addr: '广州市白云区人和龙苑小区',
                    nextstate: [
                        /*{name:"拍照",url:"http://127.0.0.1/拍照"},
                        {name:"扫描",url:"http://127.0.0.1/扫描"},*/
                        {name:"解困",url:"http://127.0.0.1/解困"}
                    ],
                    taskid: 'TASK123456',
                    url: '查询明细url',
                    urgent: '',
                    statusColor: '',
                    titleIcon: '',
                    titleColor: '',
                },
                {
                    operdate: '2015-12-01 11:55',
                    istrap: '1',
                    state: '已完成',
                    trno: 'BX2015060406',
                    unitname: '广州市粤商投资有限公司',
                    addr: '广州市白云区人和龙苑小区',
                    nextstate: [],
                    taskid: 'TASK123456',
                    url: '查询明细url',
                    urgent: '',
                    statusColor: '',
                    titleIcon: '',
                    titleColor: '',
                },
                {
                    operdate: '2015-12-01 11:55',
                    istrap: '0',
                    state: '已完成',
                    trno: 'BX2015060406',
                    unitname: '广州市粤商投资有限公司',
                    addr: '广州市白云区人和龙苑小区',
                    nextstate: [],
                    taskid: 'TASK123456',
                    url: '查询明细url',
                    urgent: '',
                    statusColor: '',
                    titleIcon: '',
                    titleColor: '',
                },
            ]);
            this.setData(d);
            onSuccess(d.length);
        }
    },

    updateDat: function(onSuccess, onFailure, parm) {

    },

    filteDat: function(parm) {
        this.clearFilter();

        if(parm!=='') {
            this.filterBy(function(item) {
                var s = item.get('unitname') + ' ' + item.get('addr') + ' ' +
                    item.get('operdate') + ' ' + item.get('istrap');
                return (s.toUpperCase().indexOf(parm.toUpperCase())>=0);
            });
        }
    },

    decoDat: function(data) {
        if(!data) return([]);

        var statusArr = [];
        /*
        statusArr['0'  ]= { text:'待分配', color:'green' };
        statusArr['103']= { text:'关闭',   color:'gray' };
        statusArr['104']= { text:'退单',   color:'red' };
        statusArr['201']= { text:'待接收', color:'orange' };
        statusArr['202']= { text:'未出发', color:'green' };
        statusArr['301']= { text:'路途中', color:'blue' };
        statusArr['302']= { text:'维修中', color:'purple' };
        statusArr['303']= { text:'救援中', color:'purple' };
        statusArr['401']= { text:'已完成', color:'black' };
        */
        statusArr['待分配']= { code:'0',   color:'green' };
        statusArr['已关闭']= { code:'103', color:'gray' };
        statusArr['已退回']= { code:'104', color:'red' };
        statusArr['待接收']= { code:'201', color:'orange' };
        statusArr['未出发']= { code:'202', color:'green' };
        statusArr['路途中']= { code:'301', color:'blue' };
        statusArr['维修中']= { code:'302', color:'purple' };
        statusArr['救援中']= { code:'303', color:'purple' };
        statusArr['已完成']= { code:'401', color:'black' };


        // urgent、statusColor、titleIcon、titleColor 根据istrap显示:
        // urgent 		: 紧急的角标
        // statusColor	: 状态的颜色
        // titleIcon	: 标题的图标
        // titleColor	: 标题的颜色

        for(var i=0;i<data.length; i++) {
            var state = data[i].state;
            if(!statusArr[state]) {
                Ext.toast('sx_sxlist_todo 未知状态：' + state);
                continue;
            }

            data[i].operdate = data[i].operdate.split(' ')[0];
            data[i].titleColor  = 'liftnet-fontColor-' + statusArr[state].color;
            data[i].statusColor = 'liftnet-fontColor-' + statusArr[state].color;
            //data[i].state       = statusArr[state].text;

            if(data[i].istrap==='1') {
                if(state==='待分配'||
                   state==='已退回'||
                   state==='待接收'||
                   state==='未出发'||
                   state==='路途中'||
                   state==='救援中') {
                    data[i].urgent = '<div class="liftnet-remindBg liftnet-remindBg-red"></div><div class="liftnet-remind liftnet-font-size12">急</div>';
                }
                data[i].titleIcon = '<i class="ln ln-stranded"></i> ';
                data[i].istrap = '<span class="liftnet-font-size14">(困人)</span>';
            } else {
                data[i].titleIcon = '<i class="ln ln-repair"></i> ';
                data[i].istrap = '';
            }
        }

        return(data);
    }

});