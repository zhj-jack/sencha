/*
 * File: app/controller/Admin/AdmReportController.js
 *
 * This file was generated by Sencha Architect version 3.5.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.4.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.4.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('liftnet.controller.Admin.AdmReportController', {
    extend: 'Ext.app.Controller',

    config: {
        control: {
            "container#AdmReport": {
                show: 'onAdmReportShow'
            },
            "list#AdmReport_DvHotline": {
                itemtap: 'onAdmReport_DvHotlineItemTap'
            },
            "panel#AdmReportByLetter": {
                show: 'onAdmReportByLetterShow'
            },
            "button#AdmReportByLetter_BtnReturn": {
                tap: 'onAdmReportByLetter_BtnReturnTap'
            },
            "list#AdmReport_DvMaintain": {
                itemtap: 'onAdmReport_DvMaintainItemTap'
            },
            "panel#AdmReportMaintenance": {
                show: 'onAdmReportMaintenanceShow'
            },
            "button#AdmReportMaintenance_BtnReturn": {
                tap: 'onAdmReportMaintenance_BtnReturnTap'
            },
            "list#AdmReport_DvFault": {
                itemtap: 'onAdmReport_DvFaultItemTap'
            },
            "panel#AdmReportFault": {
                show: 'onAdmReportFaultShow'
            },
            "button#AdmReportFault_BtnReturn": {
                tap: 'onAdmReportFault_BtnReturnTap'
            },
            "list#AdmReport_DvPerformance": {
                itemtap: 'onAdmReport_DvPerformanceItemTap'
            },
            "panel#AdmReportPerformance": {
                show: 'onAdmReportPerformanceShow'
            },
            "button#AdmReportPerformance_BtnReturn": {
                tap: 'onAdmReportPerformance_BtnReturnTap'
            }
        }
    },

    /* ********** 管理报表 ********** */
    onAdmReportShow: function(component, eOpts) {
        // 首页-热线受信报表
        loadMask.show();
        Ext.getCmp('AdmReport_DvHotline').getStore().loadDat(loadMask.hide);

        // 首页-保养计划报表
        loadMask.show();
        Ext.getCmp('AdmReport_DvMaintain').getStore().loadDat(loadMask.hide);

        // 首页-故障报告书报表
        loadMask.show();
        Ext.getCmp('AdmReport_DvFault').getStore().loadDat(loadMask.hide);

        // 首页-维保业绩报表
        loadMask.show();
        Ext.getCmp('AdmReport_DvPerformance').getStore().loadDat(loadMask.hide);
    },

    /* 报表-热线受信报表 */
    onAdmReport_DvHotlineItemTap: function(dataview, index, target, record, e, eOpts) {
        this.doAdmReport('AdmReportByLetter', record);
    },

    onAdmReportByLetterShow: function(component, eOpts) {
        this.doAdmReportShow({
            title : component.initialConfig.parm.title,
            count : component.initialConfig.parm.count,
            yearMonth : component.initialConfig.parm.yearMonth,
            storeId : 'reportsta_sxreportdetail_tdate',
            formId : 'form_reportsta_sxreportdetail_tdate',
            titleId : 'AdmReportByLetter_lblAllCount'
        });
    },

    onAdmReportByLetter_BtnReturnTap: function(button, e, eOpts) {
        viewUtil.goLast();
    },

    /* 报表-保养计划报表 */
    onAdmReport_DvMaintainItemTap: function(dataview, index, target, record, e, eOpts) {
        this.doAdmReport('AdmReportMaintenance', record);
    },

    onAdmReportMaintenanceShow: function(component, eOpts) {
        this.doAdmReportShow({
            title : component.initialConfig.parm.title,
            count : component.initialConfig.parm.count,
            yearMonth : component.initialConfig.parm.yearMonth,
            storeId : 'reportsta_byreportdetail_tdate',
            formId : 'form_reportsta_byreportdetail_tdate',
            titleId : 'AdmReportMaintenance_lblAllCount'
        });
    },

    onAdmReportMaintenance_BtnReturnTap: function(button, e, eOpts) {
        viewUtil.goLast();
    },

    /* 报表-故障报告书报表 */
    onAdmReport_DvFaultItemTap: function(dataview, index, target, record, e, eOpts) {
        this.doAdmReport('AdmReportFault', record);
    },

    onAdmReportFaultShow: function(component, eOpts) {
        this.doAdmReportShow({
            title : component.initialConfig.parm.title,
            count : component.initialConfig.parm.count,
            yearMonth : component.initialConfig.parm.yearMonth,
            storeId : 'reportsta_gzreportdetail_tdate',
            formId : 'form_reportsta_gzreportdetail_tdate',
            titleId : 'AdmReportFault_lblAllCount'
        });
    },

    onAdmReportFault_BtnReturnTap: function(button, e, eOpts) {
        viewUtil.goLast();
    },

    /* 报表-维保业绩报表 */
    onAdmReport_DvPerformanceItemTap: function(dataview, index, target, record, e, eOpts) {
        this.doAdmReport('AdmReportPerformance', record);
    },

    onAdmReportPerformanceShow: function(component, eOpts) {
        this.doAdmReportShow({
            title : component.initialConfig.parm.title,
            count : component.initialConfig.parm.count,
            yearMonth : component.initialConfig.parm.yearMonth,
            storeId : 'reportsta_wbyjreportdetail_tdate',
            formId : 'form_reportsta_wbyjreportdetail_tdate',
            titleId : 'AdmReportPerformance_lblAllCount'
        });
    },

    onAdmReportPerformance_BtnReturnTap: function(button, e, eOpts) {
        viewUtil.goLast();
    },

    /* 管理报表入口 */
    doAdmReport: function(viewId, record) {
        var title = record.get('title');
        var count = record.get('count');

        // 确定月份yyyymm
        var yr, mon, yearMonth;
        var today = Ext.Date.format(new Date(), 'Y-m-d');
        yr  = parseInt(today.split('-')[0]);
        mon = parseInt(today.split('-')[1]);
        if(title.indexOf('当月')>=0) {

        } else if(title.indexOf('上月')>=0) {
            mon = mon - 1;
            if(mon===0) {
                mon = 12;
                yr = yr - 1;
            }
        } else {
            Ext.toast('未找到' + title + '报表');
            return;
        }
        yearMonth = yr.toString() + '-' + global.pad2(mon);

        // 进入报表页面
        viewUtil.goNext('Admin.' + viewId, {
            title: title,
            count: count,
            yearMonth: yearMonth
        });
    },

    /* 进入报表页面时取数 */
    doAdmReportShow: function(parm) {
        var title = parm.title;
        var count = parm.count;
        var yearMonth = parm.yearMonth;
        var storeId = parm.storeId;
        var formId = parm.formId;
        var titleId = parm.titleId;

        console.log(parm);
        loadMask.show();
        var store = dataUtil.createStore(storeId);
        store.loadDat(
            function() {
                loadMask.hide();
                Ext.getCmp(formId).setRecord(store.getData().get(0));
                Ext.getCmp(titleId).setHtml(title + ' ' + count);
            },
            loadMask.hide,
            yearMonth
        );
    }

});